<html>
	{% include "../common_head.html" %}
	<body>
	{% include "../common_menus.html" %}
		<div id="content">
		
		<div id="stylized" class="rakontu_form">
		<form action="/visit/relate
		{% if entry %}
		?{{entry.key}}
		{% endif %}
		" method="post" enctype="multipart/form-data">
		
			{% if related_links %}
				<h3>Entries related to this {{entry.type}}</h3>
				<fieldset>
		      	<table border="1" cellpadding="4" cellspacing="0">
		      	<tr>
		      		<th>Title (type)</th>
		      		<th>Incoming or outgoing?</th>
		      		<th>Created by</th>
		      		<th>Text</th>
		      		<th>Relation comment</th>
		      		<th>Remove?</th>
		      		</tr>
		      		{% for link in related_links %}
		  				<tr>
		  				<td>
		  				{% ifequal entry.key link.entryTo.key %}
		  					<a href="read?{{link.entryFrom.key}}">{{link.entryFrom.title}}</a> ({{link.entryFrom.type}})
		  				{% else %}
		  					<a href="read?{{link.entryTo.key}}">{{link.entryTo.title}}</a> ({{link.entryTo.type}})
		  				{% endifequal %}
		  				</td>
		  				<td>
		  				{% ifequal entry.key link.entryTo.key %}
		  					incoming
		  				{% else %}
		  					outgoing
		  				{% endifequal %}
		  				</td>
		  				<td>
							{% if link.creator.active %}
								<a href="member?{{link.creator.key}}">{{link.creator.nickname}}</a>
								{% ifequal link.creator.key current_member.key %}
									 (you)
								{% endifequal %}
							{% else %}
								the former member "{{link.creator.nickname}}"
							{% endif %}
		  				</td>
		  				<td>{{link.entryTo.shortFormattedText|orNone}}</td>
		  				<td><input type="text" name="linkComment|{{link.key}}" value="{{link.comment}}" size="40"/></td>
		  				<td>
		  					<input type="checkbox" name="removeLink|{{ link.key }}" value="yes" id="removeLink|{{ link.key }}"/>
							<label for="removeLink|{{ link.key }}">Remove</label>
		  					</td>
		  				</tr>
		      		{% endfor %}
		      	</table>
		      	</fieldset>
	      {% endif %}
			<h3>Relate this {{entry.type}} to other entries</h3>
			<fieldset>
			<table  style="border:none;padding:0;margin:0;"><tr>
	      		{% for anEntry in entries %}
	  				<td style="border:none;padding:0;margin:0;">
	  					<input type="checkbox" name="addLink|{{ anEntry.key }}" value="yes" id="addLink|{{ anEntry.key }}"/>
						<label for="addLink|{{ anEntry.key }}"><a href="read?{{anEntry.key}}">{{anEntry.title}}</a></label>
	  					</td>
	  				<td style="border:none;padding:0;margin:0;">
	  				<input type="text" name="linkComment|{{anEntry.key}}" value="" size="40" maxlength="{{maxlength_subject_or_comment}}"/>
	  				</td></tr>
	      		{% endfor %}
	      	</table>
	      	</table>
	      	</fieldset>
			
			<p>
			<center>
			{% if related_links %}
				<input type="submit" name="save" value="Save changes" class="button">
			{% else %}
				<input type="submit" name="save" value="Save new relations" class="button">
			{% endif %}
			</center>
			
		</form>
		</div>
		</div>
	{% include "../common_footer.html" %}
	</body>
</html>
