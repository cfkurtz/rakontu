<html>
	{% include "../common_head.html" %}
	<body>
	{% include "../common_menus.html" %}
		<div id="content">
		
		<div id="stylized" class="rakontu_form">
		<form action="/visit/entry
		{% if entry %}
		?{{entry.key}}
		{% endif %}
		" method="post" enctype="multipart/form-data">
		
			{% if entry %}
				<h3>{{entry.title}} ({{entry_type}})</h3>
			{% else %}
				<h3>New {{entry_type|capfirst}}</h3>
			{% endif %}
			<fieldset>
			{% if entry %}
				You can change the text of the {{entry_type}} here.
			{% else %}
				{% ifequal entry_type "story" %}
					Please tell your story here.
				{% endifequal %}
				{% ifequal entry_type "pattern" %}
					Please describe the pattern of stories you want to make note of here.
				{% endifequal %}
				{% ifequal entry_type "collage" %}
					Please describe your collage here. 
				{% endifequal %}
				{% ifequal entry_type "invitation" %}
					Please describe to other members what you would like them to tell stories about.
				{% endifequal %}
				{% ifequal entry_type "resource" %}
					Type the text of your resource here.
				{% endifequal %}
			{% endif %}
			
			<table style="width:100%; border:none">
			<tr><td class="noborder">
			<textarea name="text" rows="10" cols="60">{% if entry %}{{entry.text}}{% endif %}</textarea>
			</td><td class="noborder" width="80">
			<p>Interpret as</p>
				<select name="text_format">
				{% for format in text_formats %}
					<option value="{{format}}" 
					{% ifequal entry.text_format format %}
						selected="selected"
					{% endifequal %}
					>{{format}}</option>
				{% endfor %}
				</select>
			</td></tr></table>
			
			{% if entry %}
				<p>You can change the name of this {{entry_type}} here.</p>
			{% else %}
				<p>Please give this {{entry_type}} a name.</p>
			{% endif %}
			<p><input type="text" name="title" size="60" value="{% if entry %}{{entry.title}}{% endif %}" maxlength="{{maxlength_name}}"/></p>
			
			{% if offline_members and current_member.isLiaison %}
				<p>Since you are a liaison:</p>
				<fieldset>
				Was this {{entry_type}} collected from an off-line member?</p>
				<input type="radio" name="collectedOffline" value="yes" id="collectedOffline"
					{% if entry.collectedOffline %}
					checked
					{% endif %}
				<label for="collectedOffline">Yes, it was collected from</label>
				<select name="offlineSource">
					<option value="none">(choose)</option>
					{% for aMember in offline_members %}
						<option value="{{aMember.key}}"
						{% if entry %}
							{% ifequal aMember.key entry.creator.key %}
								selected="selected"
							{% endifequal %}
						{% endif %}
						>{{aMember.nickname}}
						</option>
					{% endfor %}
				</select>
				&nbsp; on 
	  			 (year) <input type="text" name="year" size="4" value="" maxlength="4"/>
	  			 (month) <input type="text" name="month" size="4" value="" maxlength="2"/>
	  			 (day) <input type="text" name="day" size="4" value="" maxlength="2"/>
  			 	{{"#offlineCollectionDate"|tip}}			
	 			{% if character_allowed %}
					and attributed to 
					<select name="offlineAttribution">
						<option value="member"
							{% if entry %}
								{% if entry.attributedToMember %}
									selected="selected"
								{% endif %}
							{% endif %}
							>The selected member</option>
						{% if community.getCharacters %}
							{% for character in community.getCharacters %}
								<option value="{{character.key}}"
								{% if entry %}
									{% ifequal entry.character.key character.key %}
										selected="selected"
									{% endifequal %}
								{% endif %}
								>{{character.name}}</option>
							{% endfor %}
						{% endif %}
					</select>
				{% endif %}
				<br/><input type="radio" name="collectedOffline" value="no" id="notCollectedOffline"
					{% if not entry.collectedOffline %}
					checked
					{% endif %}
				<label for="notCollectedOffline">No, this is my {{entry_type}}.</label>
				{% if character_allowed %}
					&nbsp;  I'd like to say it was contributed by
					<select name="attribution">
						<option value="member"
							{% if entry %}
								{% if entry.attributedToMember %}
									selected="selected"
								{% endif %}
							{% endif %}
							>Me ({{current_member.nickname}})</option>
						{% if community.getCharacters %}
							{% for character in community.getCharacters %}
								<option value="{{character.key}}"
								{% if entry %}
									{% ifequal entry.character.key character.key %}
										selected="selected"
									{% endifequal %}
								{% endif %}
								>{{character.name}}</option>
							{% endfor %}
						{% endif %}
					</select></p>
				{% endif %}
				</fieldset>
			{% else %}
				{% if character_allowed %}
					Who would you like to say contributed this {{entry_type}}?
					<select name="attribution">
						<option value="member"
							{% if entry %}
								{% if entry.attributedToMember %}
									selected="selected"
								{% endif %}
							{% endif %}
							>Me ({{current_member.nickname}})</option>
						{% if community.getCharacters %}
							{% for character in community.getCharacters %}
								<option value="{{character.key}}"
								{% if entry %}
									{% ifequal entry.character.key character.key %}
										selected="selected"
									{% endifequal %}
								{% endif %}
								>{{character.name}}</option>
							{% endfor %}
						{% endif %}
					</select></p>
				{% endif %}
			{% endif %}

			
			{% if entry_from %}
				<p>You created this story 
				{% ifequal link_type "retell" %}
					as your own version of the story "{{entry_from.title}}."
				{% endifequal %}
				{% ifequal link_type "remind" %}
					because the story "{{entry_from.title}}" reminded you of it.
				{% endifequal %}
				{% ifequal link_type "respond" %}
					in response to the invitation "{{entry_from.title}}."
				{% endifequal %}
				Would you like to comment on 
				{% ifequal link_type "retell" %}
					why you retold the original story?
				{% endifequal %}
				{% ifequal link_type "remind" %}
					what reminded you of this story?
				{% endifequal %}
				{% ifequal link_type "respond" %}
					why you responded to the invitation?
				{% endifequal %}
				</p>
				<input type="text" name="link_comment" value="" size="60" maxlength="{{maxlength_subject_or_comment}}">
				<input type="hidden" name="link_type" value="{{link_type}}">
				<input type="hidden" name="entry_from" value="{{entry_from.key}}">
			{% endif %}
			
			</fieldset>
			
			<p>
			{% if questions %}
				{% include "questions.html" %}
			{% endif %}
			
			{% ifnotequal community.maxNumAttachments 0 %}
				<h3>Attachments</h3>
				<fieldset>
				{% if entry %}
					<p>This {{entry_type}} has these attachments. Click the Browse button to replace any attachment,
					or check the Remove box to delete it.
				{% else %}
					<p>You can attach up to {{community.maxNumAttachmentsAsText}} files to this {{entry_type}} here.
				{% endif %}
				<i>PDF, TXT, DOC, JPG, PNG only; maximum 10 megabyte limit per attachment.</i></p>
				
		      	<table border="1" cellpadding="4" cellspacing="0">
		      	<tr>
		      		<th>Name</th>
		      		<th>File</th>
		      		<th>Remove?</th>
		      		<th>{% if entry %} Replace {% else %} Attach {% endif %} </th>
		      		
		      		</tr><td><input type="text" name="attachmentName0" value="{{attachments.0.name}}" size="20" maxlength="{{maxlength_name}}"/></td>
					<td>{% if attachments.0.fileName %}
						<a href="attachment?attachment_id={{attachments.0.key}}">
						{{attachments.0.fileName}}</a>{% else %}none
						{% endif %}</td>
					<td>{% if attachments.0.fileName %}
							<input type="checkbox" name"removeAttachment|{{attachments.0.key}}" value="removeAttachment|{{attachments.0.key}}" id="0">
							<label for="0">Remove</label>{% else %}&nbsp; 
						{% endif %}</td>
					<td><input type="file" name="attachment0" size="20"/></p></td></tr>

					{% if community.allowsAtLeastTwoAttachments %}
			      		</tr><td><input type="text" name="attachmentName1" value="{{attachments.1.name}}" size="20" maxlength="{{maxlength_name}}"/></td>
						<td>{% if attachments.1.fileName %}
							<a href="attachment?attachment_id={{attachments.1.key}}">
							{{attachments.1.fileName}}</a>{% else %}none
							{% endif %}</td>
						<td>{% if attachments.1.fileName %}
								<input type="checkbox" name"removeAttachment|{{attachments.1.key}}" value="removeAttachment|{{attachments.1.key}}" id="1">
								<label for="1">Remove</label>{% else %}&nbsp; 
							{% endif %}</td>
						<td><input type="file" name="attachment1" size="20"/></p></td></tr>
				
						{% if community.allowsAtLeastThreeAttachments %}
				      		</tr><td><input type="text" name="attachmentName2" value="{{attachments.2.name}}" size="20" maxlength="{{maxlength_name}}"/></td>
							<td>{% if attachments.2.fileName %}
								<a href="attachment?attachment_id={{attachments.2.key}}">
								{{attachments.2.fileName}}</a>{% else %}none
								{% endif %}</td>
							<td>{% if attachments.2.fileName %}
									<input type="checkbox" name"removeAttachment|{{attachments.2.key}}" value="removeAttachment|{{attachments.2.key}}" id="2">
									<label for="2">Remove</label>{% else %}&nbsp; 
								{% endif %}</td>
							<td><input type="file" name="attachment2" size="20"/></p></td></tr>
							
							{% if community.allowsAtLeastFourAttachments %}
					      		</tr><td><input type="text" name="attachmentName3" value="{{attachments.3.name}}" size="20" maxlength="{{maxlength_name}}"/></td>
								<td>{% if attachments.3.fileName %}
									<a href="attachment?attachment_id={{attachments.3.key}}">
									{{attachments.3.fileName}}</a>{% else %}none
									{% endif %}</td>
								<td>{% if attachments.3.fileName %}
										<input type="checkbox" name"removeAttachment|{{attachments.3.key}}" value="removeAttachment|{{attachments.3.key}}" id="3">
										<label for="3">Remove</label>{% else %}&nbsp; 
									{% endif %}</td>
								<td><input type="file" name="attachment3" size="20"/></p></td></tr>
								
								{% if community.allowsFiveAttachments %}
					      		</tr><td><input type="text" name="attachmentName4" value="{{attachments.4.name}}" size="20" maxlength="{{maxlength_name}}"/></td>
								<td>{% if attachments.4.fileName %}
									<a href="attachment?attachment_id={{attachments.4.key}}">
									{{attachments.4.fileName}}</a>{% else %}none
									{% endif %}</td>
								<td>{% if attachments.4.fileName %}
										<input type="checkbox" name"removeAttachment|{{attachments.4.key}}" value="removeAttachment|{{attachments.4.key}}" id="4">
										<label for="4">Remove</label>{% else %}&nbsp; 
									{% endif %}</td>
								<td><input type="file" name="attachment4" size="20"/></p></td></tr>
							
								{% endif %}
							{% endif %}
						{% endif %}
					{% endif %}
				</table>
				</fieldset>
			{% endifnotequal %}
			
		{% ifequal entry_type "collage" %}
			{% if included_links_outgoing %}
				<h3>Stories included in the collage</h3>
				<fieldset>
		      	<table border="1" cellpadding="4" cellspacing="0">
		      	<tr>
		      		<th>Title</th>
		      		<th>Text</th>
		      		<th>Link comment</th>
		      		<th>Remove?</th>
		      		</tr>
		      		{% for link in included_links_outgoing %}
		  				<tr>
		  				<td><a href="read?{{link.entryTo.key}}">{{link.entryTo.title}}</a></td>
		  				<td>{{link.entryTo.shortFormattedText|orNone}}</td>
		  				<td><input type="text" name="linkComment|{{link.key}}" value="{{link.comment}}" size="40" maxlength="{{maxlength_subject_or_comment}}"/></td>
		  				<td width="80">
		  					<input type="checkbox" name="removeLink|{{ link.key }}" value="yes" id="removeLink|{{ link.key }}"/>
							<label for="removeLink|{{ link.key }}">Remove</label>
		  					</td>
		  				</tr>
		      		{% endfor %}
		      	</table>
		      	</fieldset>
	      {% endif %}
			<h3>Add stories to the collage</h3>
			<fieldset>
	      	<table border="1" cellpadding="4" cellspacing="0">
	      	<tr>
	      		<th>Include?</th>
	      		<th>Title</th>
	      		<th>Text</th>
	      		<th>Link comment</th>
	      		</tr>
	      		{% for anEntry in entries_that_can_be_linked_to_by_collage %}
	  				<tr>
	  				<td width="80">
	  					<input type="checkbox" name="addLink|{{ anEntry.key }}" value="yes" id="addLink|{{ anEntry.key }}"/>
						<label for="addLink|{{ anEntry.key }}">Include</label>
	  					</td>
	  				<td><a href="read?{{anEntry.key}}">{{anEntry.title}}</a></td>
	  				<td>{{anEntry.shortFormattedText|orNone}}</td>
	  				<td><input type="text" name="linkComment|{{anEntry.key}}" value="" size="40" maxlength="{{maxlength_subject_or_comment}}"/></td>
	  				</tr>
	      		{% endfor %}
	      	</table>
	      	</fieldset>
	  {% endifequal %}
			
			<p>
			<center>
			{% if entry %}
				{% if entry.inBatchEntryBuffer %}
					<input type="submit" name="save|{{entry_type}}" value="Save changes and return" class="button">
					<input type="submit" name="preview|{{entry_type}}" value="Preview" class="button">
				{% else %}
					<input type="submit" name="save|{{entry_type}}" value="Save draft" class="button">
					<input type="submit" name="preview|{{entry_type}}" value="Preview" class="button">
					<input type="submit" name="publish|{{entry_type}}" value="Publish" class="button">
				{% endif %}
			{% else %}
				<input type="submit" name="save|{{entry_type}}" value="Save as draft" class="button">
				<input type="submit" name="preview|{{entry_type}}" value="Preview" class="button">
				<input type="submit" name="publish|{{entry_type}}" value="Publish" class="button">
			{% endif %}
			</center>
			
		</form>
		</div>
		</div>
	{% include "../common_footer.html" %}
	</body>
</html>
