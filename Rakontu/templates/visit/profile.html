<html>
	{% include "../common_head.html" %}
	<body>
	{% include "../common_menus.html" %}
	
	
	<div id="content">
	
		<div id="stylized" class="rakontu_form">
		<form action="/visit/profile" method="post" enctype="multipart/form-data">
		{% if member.isOnlineMember %}
			<h3>Your member information</h3>
		{% else %}
			<h3>{{member.nickname}}'s information</h3>
		{% endif %}
      	<table border="1" cellpadding="4" cellspacing="0">
      	<tr>
      	{% if member.isOnlineMember %}
			<td>Member type</td><td>{{member.governanceType}}</td></tr>
		{% endif %}
		<td>Joined</td><td>{{member.joined|timeZone:member.timeZoneName|date:member.dateFormat}}</td></tr>
		<td>Last entered entry</td><td>
			{% if member.lastEnteredEntry %} 
				{{member.lastEnteredEntry|timeZone:member.timeZoneName|date:member.dateFormat}} at {{member.lastEnteredEntry|timeZone:member.timeZoneName|time:member.timeFormat}}
			{% else %}
				never
			{% endif %}
			</td></tr>
		<td>Last entered annotation</td><td>
			{% if member.lastEnteredAnnotation %} 
				{{member.lastEnteredAnnotation|timeZone:member.timeZoneName|date:member.dateFormat}} at {{member.lastEnteredAnnotation|timeZone:member.timeZoneName|time:member.timeFormat}}
			{% else %}
				never
			{% endif %}
			</td></tr>
		<td>Last answered question(s)</td><td>
			{% if member.lastAnsweredQuestion %} 
				{{member.lastAnsweredQuestion|timeZone:member.timeZoneName|date:member.dateFormat}} at {{member.lastAnsweredQuestion|timeZone:member.timeZoneName|time:member.timeFormat}}
			{% else %}
				never
			{% endif %}
			</td></tr>
		<td>Last entered link</td><td>
			{% if member.lastEnteredLink %} 
				{{member.lastEnteredLink|timeZone:member.timeZoneName|date:member.dateFormat}} at {{member.lastEnteredLink|timeZone:member.timeZoneName|time:member.timeFormat}}
			{% else %}
				never
			{% endif %}
			</td></tr>
		{% if member.isOnlineMember %}
			<td>Last read anything</td><td>
				{% if member.lastReadAnything %} 
					{{member.lastReadAnything|timeZone:member.timeZoneName|date:member.dateFormat}} at {{member.lastReadAnything|timeZone:member.timeZoneName|time:member.timeFormat}}
				{% else %}
					never
				{% endif %}
				</td></tr>
			<td>Accumulated nudge points</td><td>{{member.nudgePoints}}</td></tr>
		{% endif %}
		</table>
		
		{% if member.isOnlineMember %}
			<h3>Your saved drafts</h3>
		{% else %}
			<h3>{{member.nickname}}'s saved drafts</h3>
		{% endif %}
		{% if draft_entries %}
			<h4>Entries</h4>
	      	<table border="1" cellpadding="4" cellspacing="0">
	      	<tr><th>Entry type</th><th>Name</th><th>Created</th><th>Last changed</th><th>Remove?</th>
	      	{% for entry in draft_entries %}
		      	<tr>
		      	<td>{{entry.type}}</td>
				<td><a href="{{entry.type}}?{{entry.key}}">{{entry.title}}</a></td>
				<td>{{entry.created|timeZone:member.timeZoneName|date:member.dateFormat}} at {{entry.created|timeZone:member.timeZoneName|time:member.timeFormat}}</td>
				<td>{{entry.edited|timeZone:member.timeZoneName|date:member.dateFormat}} at {{entry.edited|timeZone:member.timeZoneName|time:member.timeFormat}}</td>
				<td><input type="checkbox" name="remove|{{ entry.key }}" value="yes" id="remove|{{ entry.key }}"/>
					<label for="remove|{{ entry.key }}">Remove</label></td>
				</tr>
			{% endfor %}
			</table>
		{% else %}
			<p><b>Entries</b> - none</p>
		{% endif %}
		{% if draft_annotations %}
		<h4>Annotations</h4>
	      	<table border="1" cellpadding="4" cellspacing="0">
	      	<tr><th>Annotation type</th><th>Name</th><th>In reference to the entry</th><th>Created</th><th>Last changed</th><th>Remove?</th>
	      	{% for annotation in draft_annotations %}
		      	<tr>
		      	<td>{{annotation.type}}</td>
				<td><a href="{{annotation.typeAsURL}}?{{annotation.key}}">{{annotation.displayString}}</a></td>
				<td><a href="read?{{annotation.entry.key}}">{{annotation.entry.title}}</a> ({{annotation.entry.type}})</td>
				<td>{{annotation.created|timeZone:member.timeZoneName|date:member.dateFormat}} at {{annotation.created|timeZone:member.timeZoneName|time:member.timeFormat}}</td>
				<td>{{annotation.edited|timeZone:member.timeZoneName|date:member.dateFormat}} at {{annotation.edited|timeZone:member.timeZoneName|time:member.timeFormat}}</td>
				<td><input type="checkbox" name="remove|{{ annotation.key }}" value="yes" id="remove|{{ annotation.key }}"/>
					<label for="remove|{{ annotation.key }}">Remove</label>
					</td>
				</tr>
			{% endfor %}
			</table>
		{% else %}
			<p><b>Annotations</b> - none</p>
		{% endif %}
		{% if first_draft_answer_per_entry %}
			<h4>Answer sets for entries</h4>
		      	<table border="1" cellpadding="4" cellspacing="0">
		      	<tr><th>Answers about entry</th><th>Created</th><th>Last changed</th><th>Remove?</th>
		      	{% for answer in first_draft_answer_per_entry %}
			      	<tr>
					<td><a href="answers?{{answer.referent.key}}">{{answer.referent.title}}</a> ({{answer.referent.type}})</td>
					<td>{{answer.created|timeZone:member.timeZoneName|date:member.dateFormat}} at {{answer.created|timeZone:member.timeZoneName|time:member.timeFormat}}</td>
					<td>{{answer.edited|timeZone:member.timeZoneName|date:member.dateFormat}} at {{answer.edited|timeZone:member.timeZoneName|time:member.timeFormat}}</td>
					<td><input type="checkbox" name="removeAnswers|{{answer.referent.key}}" value="yes" id="removeAnswers|{{answer.referent.key}}"/>
						<label for="removeAnswers|{{answer.referent.key}}">Remove</label>
						</td>
					</tr>
				{% endfor %}
				</table>
		{% else %}
			<p><b>Answer sets</b> - none</p>
		{% endif %}
		
		
		{% if searches %}
			<h4>Saved searches</h4>
		      	<table border="1" cellpadding="4" cellspacing="0">
		      	<tr>
		      		<th>Name</th>
		      		<th>Look in </th>
		      		<th>Words</th>
		      		<th>Tags</th>
		      		<th>Questions about entries</th>
		      		<th>Questions about members/characters</th>
		      		<th>Created</th>
		      		<th>Private?</th>
		      		<th>Remove?</th>
		      	{% for search in searches %}
			      	<tr>
			      	<td><a href="/visit/look?{{search.key}}">{{search.name}}</a></td>
			      	<td>
			      		{% for i in entry_types|makeRangeFromListLength %}
			      			{% if search.entryTypes|listLookup:i %}
			      				{{entry_types|listLookup:i}}<br/>
			      			{% endif %}
			      		{% endfor %}&nbsp;
			      		</td>
			      	<td>
			      		{% if search.words %}
			      			{{search.words_anyOrAll}} of {{search.words|join:", "}} <br/>
				      		{% for i in search_locations|makeRangeFromListLength %}
				      			{% if search.words_locations|listLookup:i %}
				      				{{search_locations|listLookup:i}}<br/>
				      			{% endif %}
				      		{% endfor %}
			      		{% else %}
			      			&nbsp;
			      		{% endif %}
			      		</td>
			      	<td>{% if search.tags %}
			      			{{search.tags_anyOrAll}} of {{search.tags|join:", "}}
			      		{% endif %}&nbsp;
			      		</td>
			      	<td>
			      		{% for ref in search.getEntryQuestionRefs %}
			      			{{ref.question.text}} {{ref.answer}}<br/>
			      		{% endfor %}
			      		&nbsp;
			      		</td>
			      	<td>
			      		{% for ref in search.getCreatorQuestionRefs %}
			      			{{ref.question.text}} {{ref.answer}}<br/>
			      		{% endfor %}
			      		&nbsp;
			      		</td>
					<td>{{search.created|timeZone:current_member.timeZoneName|date:current_member.dateFormat}}<br/>at {{search.created|timeZone:current_member.timeZoneName|time:current_member.timeFormat}}</td>
					<td>{{search.private|yesno:"yes, no"}}</td>
					<td width="80"><input type="checkbox" name="remove|{{ search.key }}" value="yes" id="remove|{{ search.key }}"/>
						<label for="remove|{{ search.key }}">Remove</label>
						</td>
					</tr>
				{% endfor %}
				</table>
		{% else %}
			<p><b>Saved searches</b> - none</p>
		{% endif %}
		
		<h3>{{member.isOnlineMember|yourOrThis|capfirst}} nickname and description</h3>
		<fieldset>
		{% if member.isOnlineMember %}
			<p>What nickname do you want to use in the community? <i>Note that if you change your nickname,
			the new nickname will display on all of your previous entries as well as new ones.</i></p>
		{% else %}
			<p>What nickname do you want to use to represent this off-line member in the community? 
			<i>Note that if you change this nickname,
			the new nickname will display on all of the member's previous entries as well as new ones.</i></p>
		{% endif %}
		<input type="text" name="nickname" value="{{ member.nickname }}" maxlength="{{maxlength_name}}"/>
		{% if member.isOnlineMember %}
			<p>Do you want other community members to be able to send you messages via email? 
			{% if member.isGuide %}
				<i>(Actually, since you are a guide you have to accept messages so you can answer questions.)</i>
			{% endif %}
			{{"email_not_shown"|tip}} </p>
		{% else %}
			<p>Do you want other community members to be able to send this member messages via email?
			<i>(You, as the member's liaison, will get the messages.)</i></p>
		{% endif %}
		
		{% if member.isGuide %}
			<p><input type="checkbox" name="guideAlwaysAcceptsMessages" value="yes" id="guideAlwaysAcceptsMessages"
				checked disabled>
			<label for="guideAlwaysAcceptsMessages">Yes, people can send me messages</label></p>
		{% else %}
			<p><input type="checkbox" name="acceptsMessages" value="yes" id="acceptsMessages"
				{% if member.acceptsMessages %}
					checked
				{% endif %}
				><label for="acceptsMessages">Yes, people can send {% if member.isOnlineMember %}me messages{% else %}the member messages through me{% endif %}</label></p>
		{% endif %}
		
		{% if member.isOnlineMember %}
			<p>What text format would you prefer to use by default when you create a new entry or other item with text in it?</i></p>
			<select name="preferredTextFormat">
				{% for format in text_formats %}
					<option value="{{format}}"
					{% ifequal member.preferredTextFormat format %}
						selected="selected"
					{% endifequal %}
					>{{format}}</option>
				{% endfor %}
			</select>
		{% endif %}
		
		{% if member.isOnlineMember %}
			<p>Please describe yourself to other members.</p>
		{% else %}
			<p>Please describe this off-line member to other members.</p>
		{% endif %}

				<table style="width:100%; border:none">
				<tr><td class="noborder">
				<textarea name="profileText" rows="10" cols="60">{{member.profileText}}</textarea>
				</td><td class="noborder" width="80">
				<p>Interpret as</p>
					<select name="text_format">
					{% for format in text_formats %}
						<option value="{{format}}" 
						{% ifequal member.profileText_format format %}
							selected="selected"
						{% endifequal %}
						>{{format}}</option>
					{% endfor %}
					</select>
				</td></tr></table>
		{% if show_leave_link %}
			<div class="rightalign">To leave the community, click <a href="/visit/leave?{{member.key}}">here</a>.</div>
		{% endif %}

			</fieldset>
			
		<h3>{{member.isOnlineMember|yourOrThis|capfirst}} picture</h3>
		<fieldset>
		      	<table border="1" cellpadding="4" cellspacing="0">
		      	<tr>
		      		<th>Image</th>
		      		<th>{% if member.profileImage %} Replace {% else %} Attach {% endif %} {{"profile_image"|tip}}</th>
		      		<th>Remove?</th>
		      		
		      	</tr>
		      	<tr>
					<td>{% if member.profileImage %}
							<img src="img?member_id={{member.key}}">
						{% else %}
							none
						{% endif %}
						</td>
					<td><input type="file" name="img" size="40" accept="jpg/png"/></p><p><i>The best picture size is 100 x 60.</i></p></td>
					<td>{% if member.profileImage %}
							<input type="checkbox" name="removeProfileImage" value="yes" id="removeProfileImage">
							<label for="removeProfileImage">Remove</label>{% else %}&nbsp; 
						{% endif %}</td>
				</tr>
				</table>
		</fieldset>
		
		{% if questions %}
			{% include "../common_questions.html" %}
		{% endif %}
		
		<h3>Time zones and time reporting</h3>
		<fieldset>
		{% if member.isOnlineMember %}
			<p>What time zone are you in?
		{% else %}
			<p>What time zone is this member in?
		{% endif %}
			<select name="timeZoneName"">
			{% for name in time_zone_names %}
				<option value="{{name}}"
				{% ifequal member.timeZoneName name %}
					selected="selected"
				{% endifequal %}
				>{{name}}</option>
			{% endfor %}
			</select></p>
		<p>How would {{member.isOnlineMember|youOrThis}} like dates to be displayed?
			<select name="dateFormat">
			{% for format in date_formats.keys %}
				<option value="{{format}}"
				{% ifequal member.dateFormat format %}
					selected="selected"
				{% endifequal %}
				>{{date_formats|dictLookup:format}}</option>
			{% endfor %}
			</select></p>
		<p>How would {{member.isOnlineMember|youOrThis}} like times to be displayed?
			<select name="timeFormat">
			{% for format in time_formats.keys %}
				<option value="{{format}}"
				{% ifequal member.timeFormat format %}
					selected="selected"
				{% endifequal %}
				>{{time_formats|dictLookup:format}}</option>
			{% endfor %}
			</select></p>
		</fieldset>
		
		{% if member.isOnlineMember %}
			{% if member.canTakeOnAnyHelpingRole %}
				<h3>Helping roles</h3>
				<fieldset>
				
				{% if member.helpingRolesAvailable.0 %}
					<p><label><input type="checkbox" name="helpingRole0" value="helpingRole0"
						{% if member.helpingRoles.0 %}
							checked="checked"/>
						{% else %}
							/>
						{% endif %}
						I am a <b> {{helping_role_names.0}} </b> in this community.</label></p>
					{% if community.roleReadmes_formatted.0 %}
						<table border="1" cellpadding="4" cellspacing="0">
						<tr><td bgcolor="#FFFFFF"> {{ community.roleReadmes_formatted.0 }} </td></tr>
						</table>
					{% endif %}
				{% endif %}
				
				{% if member.helpingRolesAvailable.1 %}
					<p><label><input type="checkbox" name="helpingRole1" value="helpingRole1"
						{% if member.helpingRoles.1 %}
							checked="checked"/>
						{% else %}
							/>
						{% endif %}
						I am a <b>{{helping_role_names.1}}</b> in this community.</label></p>
					{% if community.roleReadmes_formatted.1 %}
						<table border="1" cellpadding="4" cellspacing="0"><tr>
						<tr><td bgcolor="#FFFFFF"> {{ community.roleReadmes_formatted.1 }} </td></tr>
						</table>
					{% endif %}
					<p>If you are a guide, what would you like to tell members about what sorts of questions you can answer?</p>

				<table style="width:100%; border:none">
				<tr><td class="noborder">
				<textarea name="guideIntro" rows="5" cols="60">{{member.guideIntro}}</textarea>
				</td><td class="noborder" width="80">
				<p>Interpret as</p>
					<select name="guideIntro_format">
					{% for format in text_formats %}
						<option value="{{format}}" 
						{% ifequal member.guideIntro_format format %}
							selected="selected"
						{% endifequal %}
						>{{format}}</option>
					{% endfor %}
					</select>
				</td></tr></table>

				{% endif %}
				
				{% if member.helpingRolesAvailable.2 %}
					<p><label><input type="checkbox" name="helpingRole2" value="helpingRole2"
						{% if member.helpingRoles.2 %}
							checked="checked"/>
						{% else %}
							/>
						{% endif %}
						I am a <b>{{helping_role_names.2}}</b> in this community.</label></p>
					{% if community.roleReadmes_formatted.2 %}
						<table border="1" cellpadding="4" cellspacing="0">
						<tr><td bgcolor="#FFFFFF"> {{ community.roleReadmes_formatted.2 }} </td></tr>
						</table>
					{% endif %}
				{% endif %}
				</fieldset>
			{% endif %}
		{% endif %}
		
      	<p>
    <center><input type="submit" name="changeSettings|{{member.key}}" value="Save changes" class="button"></center>
	</form>	
	</div>
	</div>
	{% include "../common_footer.html" %}
	</body>
</html>
