<html>
	{% include "../common_head.html" %}
	<body>
	{% include "../common_menus.html" %}
	<div id="content">
	{% if current_member.isCuratorOrManagerOrOwner %}
		<div id="stylized" class="rakontu_form">
		<form action="/{{dir_curate}}/{{url_flags}}?{{rakontu.urlQuery}}" method="post">	
		
		<div id="stylized" class="rakontu_form">
		<form action="/{{dir_curate}}/{{url_gaps}}?{{rakontu.urlQuery}}" method="post" enctype="multipart/form-data">
		
		<h3>{{template_items_flagged_for_removal}} {{"flagging_items_for_removal"|info}}</h3>
		<p>{{template_show}}
		<select name="type">
			{% for i in flagged_item_types|makeRangeFromListLength %}
				<option value="{{flagged_item_types|listLookup:i}}" 
				{% if flagged_item_types|listLookup:i|equalTest:type %} 
					selected="selected" 
				{% endif %}
				>{{flagged_item_types_plural_display|listLookup:i}}</option>
			{% endfor %}
			</select> 
		<input type="submit" name="changeSelections" value="{{button_change}}" class="button_small">
		
			{% if type|isInList:entry_types and items %}
				<fieldset>
		      	<table border="0" cellpadding="4" cellspacing="0">
		      	<tr>
		      		<th>{{template_unflag}}? {{"unflag_item"|tip}}</th>
		      		<th>{{template_entry}}</th>
		      		<th>{{template_linked_to}}</th>
		      		<th>{{template_first_part_of_text}}</th>
		      		<th>{{template_contributor}}</th>
		      		<th>{{template_flag_comment}}</th>
		      		{% if current_member.isManagerOrOwner %} 
		      			<th>{{template_remove}}?{{"removing_flagged_items"|caution}}</th> 
		      		{% else %}  
		      			<th>{{template_notify}}? {{"flag_notifications"|caution}}</th> 
		      		{% endif %}
	      		</tr>
	      		{% for item in items %}
	  				<tr>
	  				<td width="80">
	  					<input type="checkbox" name="unflag|{{item.key}}" value="yes" id="unflag|{{item.key}}"/>
						<label for="unflag|{{item.key}}">{{template_unflag}}</label>
	  				</td>	  				
	  				<td>{{item.linkString}}</td>
	  				<td>
	  				{% for link in item.getIncomingLinks %}
	  					<p>{{link.linkStringWithFromItem}}</p>
	  				{% endfor %}&nbsp;
	  				</td>
	  				<td>{{item.text_formatted|upTo:100|orNbsp}}</td>
	  				<td>
						{% if item.attributedToMember %}
								{% if item.creator.active %}
									{{item.creator.linkString}}
									{% ifequal item.creator.key current_member.key %}
										 ({{template_you}})
									{% endifequal %}
								{% else %}
									{{template_the_former_member}} "{{item.creator.nickname}}"
								{% endif %}
						{% else %}
							{% if item.character.active %}
								{{item.character.linkString}}
							{% else %}
								{{template_the_former_character}} "{{item.character.name}}"
							{% endif %}
						{% endif %}
	  				</td>
	  				<td><input type="text" name="flagComment|{{item.key}}" value="{{item.flagComment|orNothing}}" maxlength="{{maxlength_subject_or_comment}}"></td>
	  				<td width="80">
	  				{% if current_member.isManagerOrOwner %}
	  						<input type="checkbox" name="remove|{{item.key}}" value="yes" id="remove|{{item.key}}"/>
							<label for="remove|{{item.key}}">{{template_remove}}</label>
	  				{% else %}
	  						<input type="checkbox" name="notify|{{item.key}}" value="yes" id="notify|{{item.key}}"/>
							<label for="notify|{{item.key}}">{{template_notify}}</label>
	  				{% endif %}	
	  				</td>	  				
	  				</tr>
	      		{% endfor %}
		      	</table>
	      		</fieldset>
	      	{% endif %}
	      	
	      	{% if items %}
				{% if type|isInList:annotation_types or type|equalTest:"tagset" %}
					<fieldset>
			      	<table border="0" cellpadding="4" cellspacing="0">
			      	<tr>
			      		<th>{{template_unflag}}?</th>
			      		<th>{{template_entry}}</th>
			      		<th>{{template_content}}</th>
			      		<th>{{template_contributor}}</th>
			      		<th>{{template_flag_comment}}</th>
			      		{% if current_member.isManagerOrOwner %} 
			      			<th>{{template_remove}}?</th> 
			      		{% else %}  
			      			<th>{{template_notify}}?</th> 
			      		{% endif %}
		      		</tr>
		      		{% for item in items %}
		  				<tr>
		  				<td>
		  					<input type="checkbox" name="unflag|{{item.key}}" value="yes" id="unflag|{{item.key}}"/>
							<label for="unflag|{{item.key}}">{{template_unflag}}</label>
		  				</td>	  				
		  				<td>{{item.entry.linkString}}</td>
		  				<td>
		  				{% if item.isComment or item.isRequest %}
		  					{{item.linkString|orNbsp}}
		  				{% else %}
		  					{{item.displayString|orNbsp}}
		  				{% endif %}
		  				{% if item.isNudge %}
		  					{% if nudge.shortString and current_member.isManagerOrOwner %}
			  						<p><input type="checkbox" name="removeComment|{{item.key}}" value="yes" id="removeComment|{{item.key}}"/>
									<label for="removeComment|{{item.key}}">{{template_remove}} {{template_comment_only}}</label></p>
							{% endif %}
		  				{% endif %}
		  				</td>
		  				<td>
							{% if item.attributedToMember %}
									{% if item.creator.active %}
										{{item.creator.linkString}}
										{% ifequal item.creator.key current_member.key %}
											 ({{template_you}})
										{% endifequal %}
									{% else %}
										{{template_the_former_member}} "{{item.creator.nickname}}"
									{% endif %}
							{% else %}
								{% if item.character.active %}
									{{item.character.linkString}}
								{% else %}
									{{template_the_former_character}} "{{item.character.name}}"
								{% endif %}
							{% endif %}
		  				</td>
		  				<td><input type="text" name="flagComment|{{item.key}}" value="{{item.flagComment|orNothing}}" maxlength="{{maxlength_subject_or_comment}}"></td>
		  				<td>
		  				{% if current_member.isManagerOrOwner %}
		  						<input type="checkbox" name="remove|{{item.key}}" value="yes" id="remove|{{item.key}}"/>
								<label for="remove|{{item.key}}">{{template_remove}}</label>
		  				{% else %}
		  						<input type="checkbox" name="notify|{{item.key}}" value="yes" id="notify|{{item.key}}"/>
								<label for="notify|{{item.key}}">{{template_notify}}</label>
		  				{% endif %}	
		  				</tr>
		      		{% endfor %}
			      	</table>
			      	</fieldset>
		      	{% endif %}
		    {% endif %}
      	
			{% if type|equalTest:"answer" and items %}
				<fieldset>
		      	<table border="0" cellpadding="4" cellspacing="0">
		      	<tr>
		      		<th>{{template_unflag}}?</th>
		      		<th>{{template_entry}}</th>
		      		<th>{{template_question}}</th>
		      		<th>{{template_answer}}</th>
		      		<th>{{template_contributor}}</th>
		      		<th>{{template_flag_comment}}</th>
		      		{% if current_member.isManagerOrOwner %} 
		      			<th>{{template_remove}}?</th> 
		      		{% else %}  
		      			<th>{{template_notify}}?</th> 
		      		{% endif %}
	      		</tr>
	      		{% for item in items %}
	  				<tr>
	  				<td>
	  					<input type="checkbox" name="unflag|{{item.key}}" value="yes" id="unflag|{{item.key}}"/>
						<label for="unflag|{{item.key}}">{{template_unflag}}</label>
	  				</td>	  				
	  				<td>{{item.referent.linkString}}</td>
	  				<td>{{item.question.text}}</td>
	  				<td>{{item.displayStringShort}}</td>
	  				<td>
						{% if item.attributedToMember %}
								{% if item.creator.active %}
									{{item.creator.linkString}}
									{% ifequal item.creator.key current_member.key %}
										 ({{template_you}})
									{% endifequal %}
								{% else %}
									{{template_the_former_member}} "{{item.creator.nickname}}"
								{% endif %}
						{% else %}
							{% if item.character.active %}
								{{item.character.linkString}}
							{% else %}
								{{template_the_former_character}} "{{item.character.name}}"
							{% endif %}
						{% endif %}
	  				</td>
	  				<td><input type="text" name="flagComment|{{item.key}}" value="{{item.flagComment|orNothing}}" maxlength="{{maxlength_subject_or_comment}}"></td>
	  				<td>
	  				{% if current_member.isManagerOrOwner %}
	  						<input type="checkbox" name="remove|{{item.key}}" value="yes" id="remove|{{item.key}}"/>
							<label for="remove|{{item.key}}">{{template_remove}}</label>
	  				{% else %}
	  						<input type="checkbox" name="notify|{{item.key}}" value="yes" id="notify|{{item.key}}"/>
							<label for="notify|{{item.key}}">{{template_notify}}</label>
	  				{% endif %}	
	  				</tr>
	      		{% endfor %}
		      	</table>
		      	</fieldset>
	      	{% endif %}
      	
			{% if type|equalTest:"link" and items %}
				<fieldset>
		      	<table border="0" cellpadding="4" cellspacing="0">
		      	<tr>
		      		<th>{{template_unflag}}?</th>
		      		<th>{{template_from|capitalize}}</th>
		      		<th>{{template_to|capitalize}}</th>
		      		<th>{{template_comment}}</th>
		      		<th>{{template_flag_comment}}</th>
		      		{% if current_member.isManagerOrOwner %} 
		      			<th>{{template_remove}}?</th> 
		      		{% else %}  
		      			<th>{{template_notify}}?</th> 
		      		{% endif %}
	      		</tr>
	      		{% for item in items %}
	  				<tr>
	  				<td>
	  					<input type="checkbox" name="unflag|{{item.key}}" value="yes" id="unflag|{{item.key}}"/>
						<label for="unflag|{{item.key}}">{{template_unflag}}</label>
	  				</td>	  				
	  				<td>{{item.itemFrom.linkString}}</td>
	  				<td>{{item.itemTo.linkString}}</td>
	  				<td>{{item.comment|orNbsp}}
	  					{% if item.comment and current_member.isManagerOrOwner %}
		  						<p><input type="checkbox" name="removeComment|{{item.key}}" value="yes" id="removeComment|{{item.key}}"/>
								<label for="removeComment|{{item.key}}">{{template_remove}} {{template_comment_only}}</label></p>
						{% endif %}
	  				</td>
	  				<td><input type="text" name="flagComment|{{item.key}}" value="{{item.flagComment|orNothing}}" maxlength="{{maxlength_subject_or_comment}}"></td>
	  				<td>
	  				{% if current_member.isManagerOrOwner %}
	  						<input type="checkbox" name="remove|{{item.key}}" value="yes" id="remove|{{item.key}}"/>
							<label for="remove|{{item.key}}">{{template_remove}}</label>
	  				{% else %}
	  						<input type="checkbox" name="notify|{{item.key}}" value="yes" id="notify|{{item.key}}"/>
							<label for="notify|{{item.key}}">{{template_notify}}</label>
	  				{% endif %}	
	  				</tr>
	      		{% endfor %}
		      	</table>
		      	</fieldset>
	      	{% endif %}
      	
			{% if type|equalTest:"filter" and items %}
				<fieldset>
		      	<table border="0" cellpadding="4" cellspacing="0">
		      	<tr><th>{{template_unflag}}? {{"unflagging_items"|tip}}</th>
		      		<th>{{template_name}}</th>
		      		<th>{{template_linked_to}}</th>
		      		<th>{{template_words}}</th>
		      		<th>{{template_tags}}</th>
		      		<th>{{template_entry_questions}}</th>
		      		<th>{{template_member_questions}}</th>
		      		<th>{{template_created}}</th>
		      		<th>{{template_flag_comment}}</th>
		      		{% if current_member.isManagerOrOwner %} 
		      			<th>{{template_remove}}?{{"removing_flagged_items"|caution}}</th> 
		      		{% else %}  
		      			<th>{{template_notify}}?</th> 
		      		{% endif %}
	      		</tr>
	      		{% for item in items %}
	  				<tr>
	  				<td width="80">
	  					<input type="checkbox" name="unflag|{{item.key}}" value="yes" id="unflag|{{item.key}}"/>
						<label for="unflag|{{item.key}}">{{template_unflag}}</label>
	  				</td>	  				
	  				<td>{{item.linkString}}</td>
	  				<td>
	  				{% for link in item.getIncomingLinks %}
	  					<p>{{link.linkStringWithFromItem}}</p>
	  				{% endfor %}&nbsp;
	  				</td>
			      	<td>
			      		{% if item.words %}
			      			{{item.words_anyOrAll}}: {{item.words|join:", "}} <br/>
				      		{% for i in search_locations|makeRangeFromListLength %}
				      			{% if item.words_locations|listLookup:i %}
				      				{{search_locations_display|listLookup:i}}<br/>
				      			{% endif %}
				      		{% endfor %}
			      		{% else %}
			      			&nbsp;
			      		{% endif %}
			      		</td>
			      	<td>{% if item.tags %}
			      			{{item.tags_anyOrAll}}: {{item.tags|join:", "}}
			      		{% endif %}&nbsp;
			      		</td>
			      	<td>
			      		{% for ref in item.getEntryQuestionRefs %}
			      			{{ref.question.text}} {{ref.answer}}<br/>
			      		{% endfor %}
			      		&nbsp;
			      		</td>
			      	<td>
			      		{% for ref in item.getCreatorQuestionRefs %}
			      			{{ref.question.text}} {{ref.answer}}<br/>
			      		{% endfor %}
			      		&nbsp;
			      		</td>
					<td>{{item.created|timeZone:current_member.timeZoneName|time:current_member.timeFormat}}
					    {{item.created|timeZone:current_member.timeZoneName|date:current_member.dateFormat}}<br/>
					 </td>
	  				<td><input type="text" name="flagComment|{{item.key}}" value="{{item.flagComment|orNothing}}" maxlength="{{maxlength_subject_or_comment}}"></td>
	  				<td width="80">
	  				{% if current_member.isManagerOrOwner %}
	  						<input type="checkbox" name="remove|{{item.key}}" value="yes" id="remove|{{item.key}}"/>
							<label for="remove|{{item.key}}">{{template_remove}}</label>
	  				{% else %}
	  						<input type="checkbox" name="notify|{{item.key}}" value="yes" id="notify|{{item.key}}"/>
							<label for="notify|{{item.key}}">{{template_notify}}</label>
	  				{% endif %}	
	  				</td>	  				
	  				</tr>
	      		{% endfor %}
		      	</table>
	      		</fieldset>
	      	{% endif %}
	      	
      	{% if items %}
			<p>&nbsp; </p>
		    <center>
		    {% if current_member.isManagerOrOwner %}
		    	<p><i><b>{{template_remove_warning}}</b></i></p>
		    	<input type="submit" name="submitChanges" value="{{button_make_selected_changes}}" class="button">&nbsp; 
		    {% else %}
		    	<input type="submit" name="submitChanges" value="{{button_send_selected_notifications}}" class="button">&nbsp; 
		    {% endif %}
		{% else %}
			<p>{{template_no_flagged_items_of_this_type}}</p>
		{% endif %}
		</form>	
		</div>
	{% else %}
		<p>{{no_access|dictLookup:"flags"}}</p>
	{% endif %}
	</div>
	{% include "../common_footer.html" %}
	</body>
</html>
